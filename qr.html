<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SA1L.CC - your qr code</title>
  
  <!-- QR code libraries -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/form-components.css">
  <link rel="stylesheet" href="/css/base-components.css">
  <link rel="stylesheet" href="/css/receipt.css">
  <link rel="stylesheet" href="/css/qr-render.css">
  
  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import {
      getAuth,
      onAuthStateChanged,
      signInWithPopup,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
      GoogleAuthProvider,
      GithubAuthProvider
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyD-f9TGmva8BXdX6_b460tdrUkzTGkbjjw",
      authDomain: "qr-redirect-site-1f3b9.firebaseapp.com",
      projectId: "qr-redirect-site-1f3b9",
      storageBucket: "qr-redirect-site-1f3b9.firebasestorage.app",
      messagingSenderId: "877135858527",
      appId: "1:877135858527:web:ee7e79d851e61e06ded09e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    window.firebaseAuth = {
      auth,
      onAuthStateChanged,
      signInWithPopup,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
      GoogleAuthProvider,
      GithubAuthProvider
    };
  </script>
</head>
<body>
  <div class="receipt-wrapper">
    <div class="receipt-header">
      <pre class="site-logo"></pre>
      <h1 class="site-logo-text">SA1L.CC</h1>
      <div class="site-description">generate and manage short qr redirect links</div>
    </div>

    <div id="auth">
      <a href="/">
        <button class="secondary-btn">← back to generator</button>
      </a>
      <a href="/dashboard.html">
        <button style="display:none;" id="dashboard-btn">dashboard</button>
      </a>
      <span id="user-info"></span>
    </div>
  
    <div id="loading" class="receipt-section" style="text-align: center;">
      <p>loading qr code...</p>
    </div>

    <div id="error" class="receipt-section" style="display: none; color: #c00;"></div>

    <div id="content" style="display: none;">
      <div class="receipt-section">
        <div class="section-title">━━━ your qr code ━━━</div>
        <div id="qr-canvas" style="text-align: center; margin: 20px 0;"></div>
        <p class="small-text" style="text-align: center;">(scan to test)</p>
        <div style="text-align: center; margin-top: 15px;">
          <button onclick="downloadQR()">download qr code</button>
          <div class="qr-size-dropdown" style="margin-top: 10px;">
            <button class="qr-size-toggle" onclick="toggleSizeDropdown()">more sizes ▾</button>
            <div class="qr-size-options" id="size-dropdown">
              <a onclick="downloadQRSize(512, 'medium')">medium 512px</a>
              <a onclick="downloadQRSize(1024, 'large')">large 1024px</a>
            </div>
          </div>
        </div>
      </div>
      
      <div class="receipt-section">
        <p><strong>your short url:</strong></p>
        <p>
        <div class="responsive-inline">
            <a href="" id="redirect-url" target="_blank" rel="noopener noreferrer">
                <code id="redirect-url-text"></code>
            </a>
            <button class="secondary-btn" onclick="copyToClipboard('redirect')">copy url</button>
        </div>
        </p>
        <p class="small-text">(click to test)</p>           
        <p><strong>destination:</strong></p>
        <p>
        <a href="" id="destination-url" target="_blank" rel="noopener noreferrer">
            <code id="destination-url-text"></code>
        </a>
        </p>
        <p class="small-text">(click to test)</p>
      </div>

      <div class="receipt-section">
        <div class="section-title">━━━ edit destination ━━━</div>
        <div id="auth-required" style="display: none;">
          <p>⚠️ please <a href="/">log in</a> to edit this qr code's destination.</p>
        </div>
        <div id="edit-form" style="display: none;">
          <p class="small-text">change where this qr code redirects to:</p>
          <p class="small-text light-text">(you can do this at any time by logging in again later)</p>
          <input type="text" id="new-destination" placeholder="https://new-destination.com" />
          <br><br>
          <button id="save-btn" onclick="updateDestination()">update destination</button>
          <span id="save-status" class="secondary-btn"></span>
        </div>
      </div>

      <div class="receipt-section vertical-flex" style="text-align: center;">
        <button onclick="downloadQR()">download qr code</button>
        <button onclick="window.location.href='/dashboard.html'">see all my qr codes</button>
        <button onclick="window.location.href='/'">create another</button>
      </div>
    </div>

    <div class="receipt-footer"></div>
  </div>

  <script type="module" src="/qr.js"></script>
</body>
</html>
