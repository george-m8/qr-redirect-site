<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SA1L.CC - generating qr code...</title>

  <link rel="apple-touch-icon" sizes="57x57" href="img/fav/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="img/fav/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="img/fav/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="img/fav/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="img/fav/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="img/fav/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="img/fav/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="img/fav/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="img/fav/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="img/fav/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="img/fav/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="img/fav/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="img/fav/favicon-16x16.png">
  <link rel="manifest" href="img/fav/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="img/fav/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js" defer></script>
  
  <link rel="stylesheet" href="/css/form-components.css">
  <link rel="stylesheet" href="/css/base-components.css">
  <link rel="stylesheet" href="/css/receipt.css">
  <link rel="stylesheet" href="/css/qr-render.css">
</head>
<body class="no-overlay">
  <div class="receipt-wrapper">
    <div class="receipt-header">
      <pre class="site-logo"></pre>
      <h1 class="site-logo-text">SA1L.CC</h1>
      <div class="site-description">generate and manage short qr redirect links</div>
    </div>
  
    <div class="receipt-section" style="text-align: center;">
      <div class="section-title">━━━ generating your qr code ━━━</div>
      <p style="margin: 24px 0 8px 0;">please wait a moment...</p>
      <div id="ad-spinner-container" style="margin: 8px 0 12px 0;">
        <div class="spinner spinner-box" role="status" aria-live="polite">
          <div class="spinner-animation" aria-hidden="true"></div>
          <div class="spinner-text">Preparing QR</div>
        </div>
      </div>
      <p style="color: #666;">redirecting to your qr code</p>
    </div>

    <div class="receipt-footer"></div>
  </div>

  <script>
    // Get slug from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get('slug');

    if (!slug) {
      alert('No QR code specified');
      window.location.href = '/';
    } else {
      // In-place QR animation: tell the QR loader to pace reveal over 5000ms
      // Make ad spinner draw slower than the 5s presence so it doesn't fully complete before redirect
      const desiredMs = 8000;
      // set a global desired duration for qr-loader to pick up for future containers
      document._qrDesiredDuration = desiredMs;

      // also set desired on existing spinner-animation(s)
      document.querySelectorAll('.spinner-animation').forEach(el => { el._desiredDuration = desiredMs; });

      // Add a fallback button that appears at desiredMs so users can click if redirect fails
      const notRedirectBtn = document.createElement('button');
      notRedirectBtn.textContent = "Not redirected? Click here";
      notRedirectBtn.style.display = 'none';
      notRedirectBtn.className = 'secondary-btn';
      notRedirectBtn.style.marginTop = '0.6rem';
      notRedirectBtn.addEventListener('click', ()=> {
        window.location.href = `/qr.html?slug=${encodeURIComponent(slug)}`;
      });
      const container = document.getElementById('ad-spinner-container');
      if (container) container.appendChild(notRedirectBtn);

      // Show the button after desiredMs, and redirect shortly after to allow click if needed
      setTimeout(() => { notRedirectBtn.style.display = 'inline-block'; }, desiredMs);
      setTimeout(() => { window.location.href = `/qr.html?slug=${encodeURIComponent(slug)}`; }, desiredMs + 600);
    }
  </script>
    <script defer src="/transitions.js"></script>
    <script defer src="/qr-loader.js"></script>
</body>
</html>
