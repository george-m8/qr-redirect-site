<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SA1L.CC - generate fallback QR</title>

  <!-- QR code library used by utils.renderQRAsCharacters -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js" defer></script>

  <link rel="stylesheet" href="/css/form-components.css">
  <link rel="stylesheet" href="/css/base-components.css">
  <link rel="stylesheet" href="/css/receipt.css">
  <link rel="stylesheet" href="/css/qr-render.css">
</head>
<body>
  <div class="receipt-wrapper">
    <div class="receipt-header">
      <pre class="site-logo"></pre>
      <h1 class="site-logo-text">SA1L.CC</h1>
      <div class="site-description">generate fallback QR for preformatted content</div>
    </div>

    <div class="receipt-section" style="text-align:center;">
      <div class="section-title">━━━ generate fallback QR ━━━</div>
      <p class="small-text">This page generates a text-based QR for <strong>https://sa1l.cc/</strong>. Copy the contents of the <code>&lt;pre id="fallback-qr-pre"&gt;</code> below into your fallback page.</p>

      <div id="qr-render-target" style="margin: 12px 0;"></div>

      <div style="margin-top:18px; text-align:left; display:inline-block;">
        <div style="font-size:12px; color:#666; margin-bottom:8px;">Preformatted matrix (use '#' for dark, '.' for light):</div>
        <pre id="fallback-qr-pre" style="background:#fff; padding:12px; border:1px dashed #ccc; max-width:720px; overflow:auto;"></pre>
      </div>
    </div>

    <div class="receipt-footer"></div>
  </div>

  <script type="module">
    import { renderQRAsCharacters } from './utils.js';

    const text = 'https://sa1l.cc/';
    const target = document.getElementById('qr-render-target');
    const pre = document.getElementById('fallback-qr-pre');

    // Render visible character QR using project helper
    renderQRAsCharacters(text, target, { size: 'normal' }).catch(()=>{});

    // Also generate a simple '#' / '.' matrix for copy-paste
    try {
      const qr = qrcode(0, 'M');
      qr.addData(text);
      qr.make();
      const n = qr.getModuleCount();
      let lines = '';
      for (let r=0;r<n;r++){
        let line = '';
        for (let c=0;c<n;c++){
          line += qr.isDark(r,c) ? '#' : '.';
        }
        lines += line + '\n';
      }
      pre.textContent = lines.trim();
    } catch (e) {
      pre.textContent = '# fallback could not be generated';
    }
  </script>
</body>
</html>
